<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait defined by the regalloc client to provide access to its machine-instruction / CFG representation."><title>Function in regalloc2 - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-6c3ea77c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="regalloc2" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0 (05f9846f8 2025-03-31)" data-channel="1.86.0" data-search-js="search-581efc7a.js" data-settings-js="settings-6dad6058.js" ><script src="../static.files/storage-3a5871a4.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-4d63596a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../regalloc2/index.html">regalloc2</a><span class="version">0.10.2</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Function</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.block_insns" title="block_insns">block_insns</a></li><li><a href="#tymethod.block_params" title="block_params">block_params</a></li><li><a href="#tymethod.block_preds" title="block_preds">block_preds</a></li><li><a href="#tymethod.block_succs" title="block_succs">block_succs</a></li><li><a href="#tymethod.branch_blockparams" title="branch_blockparams">branch_blockparams</a></li><li><a href="#tymethod.entry_block" title="entry_block">entry_block</a></li><li><a href="#tymethod.inst_clobbers" title="inst_clobbers">inst_clobbers</a></li><li><a href="#tymethod.inst_operands" title="inst_operands">inst_operands</a></li><li><a href="#tymethod.is_branch" title="is_branch">is_branch</a></li><li><a href="#tymethod.is_ret" title="is_ret">is_ret</a></li><li><a href="#tymethod.num_blocks" title="num_blocks">num_blocks</a></li><li><a href="#tymethod.num_insts" title="num_insts">num_insts</a></li><li><a href="#tymethod.num_vregs" title="num_vregs">num_vregs</a></li><li><a href="#tymethod.spillslot_size" title="spillslot_size">spillslot_size</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.allow_multiple_vreg_defs" title="allow_multiple_vreg_defs">allow_multiple_vreg_defs</a></li><li><a href="#method.debug_value_labels" title="debug_value_labels">debug_value_labels</a></li><li><a href="#method.multi_spillslot_named_by_last_slot" title="multi_spillslot_named_by_last_slot">multi_spillslot_named_by_last_slot</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="index.html">In crate regalloc2</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="index.html">regalloc2</a></div><h1>Trait <span class="trait">Function</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/regalloc2/lib.rs.html#1042-1182">Source</a> </span></div><pre class="rust item-decl"><code>pub trait Function {
<details class="toggle type-contents-toggle"><summary class="hideme"><span>Show 17 methods</span></summary>    // Required methods
    fn <a href="#tymethod.num_insts" class="fn">num_insts</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.num_blocks" class="fn">num_blocks</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.entry_block" class="fn">entry_block</a>(&amp;self) -&gt; <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.block_insns" class="fn">block_insns</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; <a class="struct" href="struct.InstRange.html" title="struct regalloc2::InstRange">InstRange</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.block_succs" class="fn">block_succs</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>];
<span class="item-spacer"></span>    fn <a href="#tymethod.block_preds" class="fn">block_preds</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>];
<span class="item-spacer"></span>    fn <a href="#tymethod.block_params" class="fn">block_params</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>];
<span class="item-spacer"></span>    fn <a href="#tymethod.is_ret" class="fn">is_ret</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.is_branch" class="fn">is_branch</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.branch_blockparams" class="fn">branch_blockparams</a>(
        &amp;self,
        block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>,
        insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>,
        succ_idx: <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>,
    ) -&gt; &amp;[<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>];
<span class="item-spacer"></span>    fn <a href="#tymethod.inst_operands" class="fn">inst_operands</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; &amp;[<a class="struct" href="struct.Operand.html" title="struct regalloc2::Operand">Operand</a>];
<span class="item-spacer"></span>    fn <a href="#tymethod.inst_clobbers" class="fn">inst_clobbers</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="struct" href="struct.PRegSet.html" title="struct regalloc2::PRegSet">PRegSet</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.num_vregs" class="fn">num_vregs</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.spillslot_size" class="fn">spillslot_size</a>(&amp;self, regclass: <a class="enum" href="enum.RegClass.html" title="enum regalloc2::RegClass">RegClass</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>;

    // Provided methods
    fn <a href="#method.debug_value_labels" class="fn">debug_value_labels</a>(&amp;self) -&gt; &amp;[(<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>, <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>, <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>, <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.u32.html">u32</a>)] { ... }
<span class="item-spacer"></span>    fn <a href="#method.multi_spillslot_named_by_last_slot" class="fn">multi_spillslot_named_by_last_slot</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.allow_multiple_vreg_defs" class="fn">allow_multiple_vreg_defs</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a> { ... }
</details>}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait defined by the regalloc client to provide access to its
machine-instruction / CFG representation.</p>
<p>(This trait’s design is inspired by, and derives heavily from, the
trait of the same name in regalloc.rs.)</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.num_insts" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1048">Source</a><h4 class="code-header">fn <a href="#tymethod.num_insts" class="fn">num_insts</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>How many instructions are there?</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.num_blocks" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1051">Source</a><h4 class="code-header">fn <a href="#tymethod.num_blocks" class="fn">num_blocks</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>How many blocks are there?</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.entry_block" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1054">Source</a><h4 class="code-header">fn <a href="#tymethod.entry_block" class="fn">entry_block</a>(&amp;self) -&gt; <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a></h4></section></summary><div class="docblock"><p>Get the index of the entry block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.block_insns" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1057">Source</a><h4 class="code-header">fn <a href="#tymethod.block_insns" class="fn">block_insns</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; <a class="struct" href="struct.InstRange.html" title="struct regalloc2::InstRange">InstRange</a></h4></section></summary><div class="docblock"><p>Provide the range of instruction indices contained in each block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.block_succs" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1060">Source</a><h4 class="code-header">fn <a href="#tymethod.block_succs" class="fn">block_succs</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>]</h4></section></summary><div class="docblock"><p>Get CFG successors for a given block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.block_preds" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1063">Source</a><h4 class="code-header">fn <a href="#tymethod.block_preds" class="fn">block_preds</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>]</h4></section></summary><div class="docblock"><p>Get the CFG predecessors for a given block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.block_params" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1066">Source</a><h4 class="code-header">fn <a href="#tymethod.block_params" class="fn">block_params</a>(&amp;self, block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>) -&gt; &amp;[<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>]</h4></section></summary><div class="docblock"><p>Get the block parameters for a given block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.is_ret" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1069">Source</a><h4 class="code-header">fn <a href="#tymethod.is_ret" class="fn">is_ret</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Determine whether an instruction is a return instruction.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.is_branch" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1073">Source</a><h4 class="code-header">fn <a href="#tymethod.is_branch" class="fn">is_branch</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Determine whether an instruction is the end-of-block
branch.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.branch_blockparams" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1079">Source</a><h4 class="code-header">fn <a href="#tymethod.branch_blockparams" class="fn">branch_blockparams</a>(
    &amp;self,
    block: <a class="struct" href="struct.Block.html" title="struct regalloc2::Block">Block</a>,
    insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>,
    succ_idx: <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a>,
) -&gt; &amp;[<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>]</h4></section></summary><div class="docblock"><p>If <code>insn</code> is a branch at the end of <code>block</code>, returns the
outgoing blockparam arguments for the given successor. The
number of arguments must match the number incoming blockparams
for each respective successor block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.inst_operands" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1086">Source</a><h4 class="code-header">fn <a href="#tymethod.inst_operands" class="fn">inst_operands</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; &amp;[<a class="struct" href="struct.Operand.html" title="struct regalloc2::Operand">Operand</a>]</h4></section></summary><div class="docblock"><p>Get the Operands for an instruction.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.inst_clobbers" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1118">Source</a><h4 class="code-header">fn <a href="#tymethod.inst_clobbers" class="fn">inst_clobbers</a>(&amp;self, insn: <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>) -&gt; <a class="struct" href="struct.PRegSet.html" title="struct regalloc2::PRegSet">PRegSet</a></h4></section></summary><div class="docblock"><p>Get the clobbers for an instruction; these are the registers
that, after the instruction has executed, hold values that are
arbitrary, separately from the usual outputs to the
instruction. It is invalid to read a register that has been
clobbered; the register allocator is free to assume that
clobbered registers are filled with garbage and available for
reuse. It will avoid storing any value in a clobbered register
that must be live across the instruction.</p>
<p>Another way of seeing this is that a clobber is equivalent to
a “late def” of a fresh vreg that is not used anywhere else
in the program, with a fixed-register constraint that places
it in a given PReg chosen by the client prior to regalloc.</p>
<p>Every register written by an instruction must either
correspond to (be assigned to) an Operand of kind <code>Def</code>, or
else must be a “clobber”.</p>
<p>This can be used to, for example, describe ABI-specified
registers that are not preserved by a call instruction, or
fixed physical registers written by an instruction but not
used as a vreg output, or fixed physical registers used as
temps within an instruction out of necessity.</p>
<p>Note that it is legal for a register to be both a clobber and
an actual def (via pinned vreg or via operand constrained to
the reg). This is for convenience: e.g., a call instruction
might have a constant clobber set determined by the ABI, but
some of those clobbered registers are sometimes return
value(s).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.num_vregs" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1121">Source</a><h4 class="code-header">fn <a href="#tymethod.num_vregs" class="fn">num_vregs</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>Get the number of <code>VReg</code> in use in this function.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.spillslot_size" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1155">Source</a><h4 class="code-header">fn <a href="#tymethod.spillslot_size" class="fn">spillslot_size</a>(&amp;self, regclass: <a class="enum" href="enum.RegClass.html" title="enum regalloc2::RegClass">RegClass</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>How many logical spill slots does the given regclass require?  E.g., on
a 64-bit machine, spill slots may nominally be 64-bit words, but a
128-bit vector value will require two slots.  The regalloc will always
align on this size.</p>
<p>(This trait method’s design and doc text derives from
regalloc.rs’ trait of the same name.)</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.debug_value_labels" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1140-1142">Source</a><h4 class="code-header">fn <a href="#method.debug_value_labels" class="fn">debug_value_labels</a>(&amp;self) -&gt; &amp;[(<a class="struct" href="struct.VReg.html" title="struct regalloc2::VReg">VReg</a>, <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>, <a class="struct" href="struct.Inst.html" title="struct regalloc2::Inst">Inst</a>, <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.u32.html">u32</a>)]</h4></section></summary><div class="docblock"><p>Get the VRegs for which we should generate value-location
metadata for debugging purposes. This can be used to generate
e.g. DWARF with valid prgram-point ranges for each value
expression in a way that is more efficient than a post-hoc
analysis of the allocator’s output.</p>
<p>Each tuple is (vreg, inclusive_start, exclusive_end,
label). In the <code>Output</code> there will be (label, inclusive_start,
exclusive_end, alloc)` tuples. The ranges may not exactly
match – specifically, the returned metadata may cover only a
subset of the requested ranges – if the value is not live for
the entire requested ranges.</p>
<p>The instruction indices imply a program point just <em>before</em>
the instruction.</p>
<p>Precondition: we require this slice to be sorted by vreg.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.multi_spillslot_named_by_last_slot" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1161-1163">Source</a><h4 class="code-header">fn <a href="#method.multi_spillslot_named_by_last_slot" class="fn">multi_spillslot_named_by_last_slot</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>When providing a spillslot number for a multi-slot spillslot,
do we provide the first or the last? This is usually related
to which direction the stack grows and different clients may
have different preferences.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.allow_multiple_vreg_defs" class="method"><a class="src rightside" href="../src/regalloc2/lib.rs.html#1179-1181">Source</a><h4 class="code-header">fn <a href="#method.allow_multiple_vreg_defs" class="fn">allow_multiple_vreg_defs</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.86.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Allow a single instruction to define a vreg multiple times. If
allowed, the semantics are as if the definition occurs only
once, and all defs will get the same alloc. This flexibility is
meant to allow the embedder to more easily aggregate operands
together in macro/pseudoinstructions, or e.g. add additional
clobbered vregs without taking care to deduplicate. This may be
particularly useful when referring to physical registers via
pinned vregs. It is optional functionality because a strict mode
(at most one def per vreg) is also useful for finding bugs in
other applications.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../trait.impl/regalloc2/trait.Function.js" async></script></section></div></main></body></html>