<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Any type implementing this trait can be passed to Session to collect execution history of specific requests. In order to use it call `set_history_listener` on `Query`, `PreparedStatement`, etc… The listener has to generate unique IDs for new requests, attempts and speculative fibers. These ids are then used by the caller to identify them. It’s important to note that even after a request is finished there still might come events related to it. These events come from speculative futures that didn’t notice the request is done already."><title>HistoryListener in scylla::observability::history - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-6c3ea77c.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="scylla" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0 (05f9846f8 2025-03-31)" data-channel="1.86.0" data-search-js="search-581efc7a.js" data-settings-js="settings-6dad6058.js" ><script src="../../../static.files/storage-3a5871a4.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-4d63596a.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../scylla/index.html">scylla</a><span class="version">1.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">History<wbr>Listener</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.log_attempt_error" title="log_attempt_error">log_attempt_error</a></li><li><a href="#tymethod.log_attempt_start" title="log_attempt_start">log_attempt_start</a></li><li><a href="#tymethod.log_attempt_success" title="log_attempt_success">log_attempt_success</a></li><li><a href="#tymethod.log_new_speculative_fiber" title="log_new_speculative_fiber">log_new_speculative_fiber</a></li><li><a href="#tymethod.log_request_error" title="log_request_error">log_request_error</a></li><li><a href="#tymethod.log_request_start" title="log_request_start">log_request_start</a></li><li><a href="#tymethod.log_request_success" title="log_request_success">log_request_success</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In scylla::<wbr>observability::<wbr>history</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">scylla</a>::<wbr><a href="../index.html">observability</a>::<wbr><a href="index.html">history</a></div><h1>Trait <span class="trait">HistoryListener</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/scylla/observability/history.rs.html#38-69">Source</a> </span></div><pre class="rust item-decl"><code>pub trait HistoryListener:
    <a class="trait" href="https://doc.rust-lang.org/1.86.0/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a>
    + <a class="trait" href="https://doc.rust-lang.org/1.86.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a>
    + <a class="trait" href="https://doc.rust-lang.org/1.86.0/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Required methods
    fn <a href="#tymethod.log_request_start" class="fn">log_request_start</a>(&amp;self) -&gt; <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.log_request_success" class="fn">log_request_success</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.log_request_error" class="fn">log_request_error</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>, error: &amp;<a class="enum" href="../../errors/enum.RequestError.html" title="enum scylla::errors::RequestError">RequestError</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.log_new_speculative_fiber" class="fn">log_new_speculative_fiber</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>) -&gt; <a class="struct" href="struct.SpeculativeId.html" title="struct scylla::observability::history::SpeculativeId">SpeculativeId</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.log_attempt_start" class="fn">log_attempt_start</a>(
        &amp;self,
        request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>,
        speculative_id: <a class="enum" href="https://doc.rust-lang.org/1.86.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="struct.SpeculativeId.html" title="struct scylla::observability::history::SpeculativeId">SpeculativeId</a>&gt;,
        node_addr: <a class="enum" href="https://doc.rust-lang.org/1.86.0/core/net/socket_addr/enum.SocketAddr.html" title="enum core::net::socket_addr::SocketAddr">SocketAddr</a>,
    ) -&gt; <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.log_attempt_success" class="fn">log_attempt_success</a>(&amp;self, attempt_id: <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.log_attempt_error" class="fn">log_attempt_error</a>(
        &amp;self,
        attempt_id: <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a>,
        error: &amp;<a class="enum" href="../../errors/enum.RequestAttemptError.html" title="enum scylla::errors::RequestAttemptError">RequestAttemptError</a>,
        retry_decision: &amp;<a class="enum" href="../../policies/retry/enum.RetryDecision.html" title="enum scylla::policies::retry::RetryDecision">RetryDecision</a>,
    );
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Any type implementing this trait can be passed to Session
to collect execution history of specific requests.<br />
In order to use it call <code>set_history_listener</code> on
<code>Query</code>, <code>PreparedStatement</code>, etc…<br />
The listener has to generate unique IDs for new requests, attempts and speculative fibers.
These ids are then used by the caller to identify them.<br />
It’s important to note that even after a request is finished there still might come events related to it.
These events come from speculative futures that didn’t notice the request is done already.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.log_request_start" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#40">Source</a><h4 class="code-header">fn <a href="#tymethod.log_request_start" class="fn">log_request_start</a>(&amp;self) -&gt; <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a></h4></section></summary><div class="docblock"><p>Log that a request has started on request start - right after the call to Session::{query,execute}_*/batch.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_request_success" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#43">Source</a><h4 class="code-header">fn <a href="#tymethod.log_request_success" class="fn">log_request_success</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>)</h4></section></summary><div class="docblock"><p>Log that request was successful - called right before returning the result from Session::query_<em>, execute_</em>, etc.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_request_error" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#46">Source</a><h4 class="code-header">fn <a href="#tymethod.log_request_error" class="fn">log_request_error</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>, error: &amp;<a class="enum" href="../../errors/enum.RequestError.html" title="enum scylla::errors::RequestError">RequestError</a>)</h4></section></summary><div class="docblock"><p>Log that request ended with an error - called right before returning the error from Session::query_<em>, execute_</em>, etc.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_new_speculative_fiber" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#49">Source</a><h4 class="code-header">fn <a href="#tymethod.log_new_speculative_fiber" class="fn">log_new_speculative_fiber</a>(&amp;self, request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>) -&gt; <a class="struct" href="struct.SpeculativeId.html" title="struct scylla::observability::history::SpeculativeId">SpeculativeId</a></h4></section></summary><div class="docblock"><p>Log that a new speculative fiber has started.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_attempt_start" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#52-57">Source</a><h4 class="code-header">fn <a href="#tymethod.log_attempt_start" class="fn">log_attempt_start</a>(
    &amp;self,
    request_id: <a class="struct" href="struct.RequestId.html" title="struct scylla::observability::history::RequestId">RequestId</a>,
    speculative_id: <a class="enum" href="https://doc.rust-lang.org/1.86.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="struct.SpeculativeId.html" title="struct scylla::observability::history::SpeculativeId">SpeculativeId</a>&gt;,
    node_addr: <a class="enum" href="https://doc.rust-lang.org/1.86.0/core/net/socket_addr/enum.SocketAddr.html" title="enum core::net::socket_addr::SocketAddr">SocketAddr</a>,
) -&gt; <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a></h4></section></summary><div class="docblock"><p>Log that an attempt has started - request has been sent on some Connection, now awaiting for an answer.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_attempt_success" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#60">Source</a><h4 class="code-header">fn <a href="#tymethod.log_attempt_success" class="fn">log_attempt_success</a>(&amp;self, attempt_id: <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a>)</h4></section></summary><div class="docblock"><p>Log that an attempt succeeded.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_attempt_error" class="method"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#63-68">Source</a><h4 class="code-header">fn <a href="#tymethod.log_attempt_error" class="fn">log_attempt_error</a>(
    &amp;self,
    attempt_id: <a class="struct" href="struct.AttemptId.html" title="struct scylla::observability::history::AttemptId">AttemptId</a>,
    error: &amp;<a class="enum" href="../../errors/enum.RequestAttemptError.html" title="enum scylla::errors::RequestAttemptError">RequestAttemptError</a>,
    retry_decision: &amp;<a class="enum" href="../../policies/retry/enum.RetryDecision.html" title="enum scylla::policies::retry::RetryDecision">RetryDecision</a>,
)</h4></section></summary><div class="docblock"><p>Log that an attempt ended with an error. The error and decision whether to retry the attempt are also included in the log.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-HistoryListener-for-HistoryCollector" class="impl"><a class="src rightside" href="../../../src/scylla/observability/history.rs.html#176-247">Source</a><a href="#impl-HistoryListener-for-HistoryCollector" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.HistoryListener.html" title="trait scylla::observability::history::HistoryListener">HistoryListener</a> for <a class="struct" href="struct.HistoryCollector.html" title="struct scylla::observability::history::HistoryCollector">HistoryCollector</a></h3></section></div><script src="../../../trait.impl/scylla/observability/history/trait.HistoryListener.js" async></script></section></div></main></body></html>