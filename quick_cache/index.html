<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Lightweight, high performance concurrent cache. It allows very fast access to the cached items with little overhead compared to a plain concurrent hash table. No allocations are ever performed unless the cache internal state table needs growing (which will eventually stabilize)."><title>quick_cache - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-6c3ea77c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="quick_cache" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0 (05f9846f8 2025-03-31)" data-channel="1.86.0" data-search-js="search-581efc7a.js" data-settings-js="settings-6dad6058.js" ><script src="../static.files/storage-3a5871a4.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-4d63596a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../quick_cache/index.html">quick_<wbr>cache</a><span class="version">0.6.16</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#eviction-policy" title="Eviction policy">Eviction policy</a></li><li><a href="#thread-safety-and-concurrency" title="Thread safety and Concurrency">Thread safety and Concurrency</a></li><li><a href="#equivalent-keys" title="Equivalent keys">Equivalent keys</a></li><li><a href="#user-defined-weight" title="User defined weight">User defined weight</a></li><li><a href="#atomic-operations" title="Atomic operations">Atomic operations</a></li><li><a href="#lifecycle-hooks" title="Lifecycle hooks">Lifecycle hooks</a></li><li><a href="#approximate-memory-usage" title="Approximate memory usage">Approximate memory usage</a></li><li><a href="#hasher" title="Hasher">Hasher</a></li><li><a href="#synchronization-primitives" title="Synchronization primitives">Synchronization primitives</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>quick_cache</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/quick_cache/lib.rs.html#1-590">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Lightweight, high performance concurrent cache. It allows very fast access to the cached items
with little overhead compared to a plain concurrent hash table. No allocations are ever performed
unless the cache internal state table needs growing (which will eventually stabilize).</p>
<h2 id="eviction-policy"><a class="doc-anchor" href="#eviction-policy">§</a>Eviction policy</h2>
<p>The current eviction policy is a modified version of the Clock-PRO algorithm, very similar to the
later published S3-FIFO algorithm. It’s “scan resistent” and provides high hit rates,
significantly better than a LRU eviction policy and comparable to other state-of-the art algorithms
like W-TinyLFU.</p>
<h2 id="thread-safety-and-concurrency"><a class="doc-anchor" href="#thread-safety-and-concurrency">§</a>Thread safety and Concurrency</h2>
<p>Both <code>sync</code> (thread-safe) and <code>unsync</code> (non thread-safe) implementations are provided. The latter
offers slightly better performance when thread safety is not required.</p>
<h2 id="equivalent-keys"><a class="doc-anchor" href="#equivalent-keys">§</a>Equivalent keys</h2>
<p>The cache uses the <a href="https://docs.rs/equivalent/1.0.1/equivalent/trait.Equivalent.html"><code>Equivalent</code></a> trait
for gets/removals. It can helps work around the <code>Borrow</code> limitations.
For example, if the cache key is a tuple <code>(K, Q)</code>, you wouldn’t be access to access such keys without
building a <code>&amp;(K, Q)</code> and thus potentially cloning <code>K</code> and/or <code>Q</code>.</p>
<h2 id="user-defined-weight"><a class="doc-anchor" href="#user-defined-weight">§</a>User defined weight</h2>
<p>By implementing the <a href="trait.Weighter.html" title="trait quick_cache::Weighter">Weighter</a> trait the user can define different weights for each cache entry.</p>
<h2 id="atomic-operations"><a class="doc-anchor" href="#atomic-operations">§</a>Atomic operations</h2>
<p>By using the <code>get_or_insert</code> or <code>get_value_or_guard</code> family of functions (both sync and async variants
are available, they can be mix and matched) the user can coordinate the insertion of entries, so only
one value is “computed” and inserted after a cache miss.</p>
<h2 id="lifecycle-hooks"><a class="doc-anchor" href="#lifecycle-hooks">§</a>Lifecycle hooks</h2>
<p>A user can optionally provide a custom <a href="trait.Lifecycle.html" title="trait quick_cache::Lifecycle">Lifecycle</a> implementation to hook into the lifecycle of cache entries.</p>
<p>Example use cases:</p>
<ul>
<li>item pinning, so even if the item occupies weight but isn’t allowed to be evicted</li>
<li>send evicted items to a channel, achieving the equivalent to an eviction listener feature.</li>
<li>zero out item weights so they are left in the cache instead of evicted.</li>
</ul>
<h2 id="approximate-memory-usage"><a class="doc-anchor" href="#approximate-memory-usage">§</a>Approximate memory usage</h2>
<p>The memory overhead per entry is <code>21</code> bytes.</p>
<p>The memory usage of the cache data structures can be estimated as:
<code>(size_of::&lt;K&gt;() + size_of::&lt;V&gt;() + 21) * (length * 1.5).next_power_of_two()</code></p>
<p>Actual memory usage may vary depending on the cache options and the key and value types, which can have external
allocations (e.g. <code>String</code>, <code>Vec</code>, etc.). The above formula only accounts for the cache’s data structures.</p>
<p>The <code>1.5</code> value in the formula above results from <code>1 + G</code>, where <code>G</code> is the configured ghost allocation specified
in <a href="struct.OptionsBuilder.html#method.ghost_allocation" title="method quick_cache::OptionsBuilder::ghost_allocation"><code>OptionsBuilder::ghost_allocation</code></a>, which is <code>0.5</code> by default.</p>
<h2 id="hasher"><a class="doc-anchor" href="#hasher">§</a>Hasher</h2>
<p>By default the crate uses <a href="https://crates.io/crates/ahash">ahash</a>, which is enabled (by default) via
a crate feature with the same name. If the <code>ahash</code> feature is disabled the crate defaults to the std lib
implementation instead (currently Siphash13). Note that a custom hasher can also be provided if desirable.</p>
<h2 id="synchronization-primitives"><a class="doc-anchor" href="#synchronization-primitives">§</a>Synchronization primitives</h2>
<p>By default the crate uses <a href="https://crates.io/crates/parking_lot">parking_lot</a>, which is enabled (by default) via
a crate feature with the same name. If the <code>parking_lot</code> feature is disabled the crate defaults to the std lib
implementation instead.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="sync/index.html" title="mod quick_cache::sync">sync</a></dt><dd>Concurrent cache variants that can be used from multiple threads.</dd><dt><a class="mod" href="unsync/index.html" title="mod quick_cache::unsync">unsync</a></dt><dd>Non-concurrent cache variants.</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Options.html" title="struct quick_cache::Options">Options</a></dt><dd>Cache options. Built with <a href="struct.OptionsBuilder.html" title="struct quick_cache::OptionsBuilder">OptionsBuilder</a>.</dd><dt><a class="struct" href="struct.OptionsBuilder.html" title="struct quick_cache::OptionsBuilder">Options<wbr>Builder</a></dt><dd>Builder for <a href="struct.Options.html" title="struct quick_cache::Options">Options</a>.</dd><dt><a class="struct" href="struct.UnitWeighter.html" title="struct quick_cache::UnitWeighter">Unit<wbr>Weighter</a></dt><dd>Each cache entry weights exactly <code>1</code> unit of weight.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.Equivalent.html" title="trait quick_cache::Equivalent">Equivalent</a></dt><dd>Key equivalence trait.</dd><dt><a class="trait" href="trait.Lifecycle.html" title="trait quick_cache::Lifecycle">Lifecycle</a></dt><dd>Hooks into the lifetime of the cache items.</dd><dt><a class="trait" href="trait.Weighter.html" title="trait quick_cache::Weighter">Weighter</a></dt><dd>Defines the weight of a cache entry.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.DefaultHashBuilder.html" title="type quick_cache::DefaultHashBuilder">Default<wbr>Hash<wbr>Builder</a></dt></dl></section></div></main></body></html>